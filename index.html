<html>
    <head>
        <title>breathe.ee</title>
        <link href="/stylesheets/app.css" rel="stylesheet" type="text/css" />
    </head>
    <body>
        <script src="/js/lib/jquery.min.js"></script>
        <script src="/js/lib/underscore.min.js"></script>
        <script src="/js/lib/three.min.js"></script>
        <script src="/js/lib/three.OrbitControls.js"></script>
        <script>
            var Workspace = function(){
                this.SCREEN_WIDTH = 600;
                this.SCREEN_HEIGHT = 400;

                this.renderer = false;
                this.camera = false;
                this.scene = false;
                this.controls = false;

                this.lights = {
                    directional: [],
                };

                this.init_renderer();
                this.init_camera();
                this.init_scene();
                this.init_lights();

                this.render_debug_helpers();

                this.update_camera();
                this.render();
            };

            Workspace.prototype.init_camera = function(){
                this.camera = new THREE.PerspectiveCamera(45, this.SCREEN_WIDTH / this.SCREEN_HEIGHT, 0.1, 10000);
                this.camera.position.set(-500, 250, -500);
            };

            Workspace.prototype.init_renderer = function(){
                this.renderer = new THREE.WebGLRenderer();
                this.renderer.setSize(this.SCREEN_WIDTH, this.SCREEN_HEIGHT);
                $("body").append(this.renderer.domElement);
            };

            Workspace.prototype.init_scene = function(){
                this.scene = new THREE.Scene();
                this.scene.fog = new THREE.FogExp2(0x000000, 0.000275);

                this.controls = new THREE.OrbitControls(this.camera, this.renderer.domElement);
            };

            Workspace.prototype.init_lights = function(){
                this.scene.add(new THREE.AmbientLight(0xffffff));

                var directional = new THREE.DirectionalLight(0xFF8D67, 0.75);
                directional.position.set(-200, 400, -200);
                this.scene.add(directional);
                this.lights.directional.push(directional);
            };

            Workspace.prototype.update_camera = function(){
                this.SCREEN_WIDTH = window.innerWidth;
                this.SCREEN_HEIGHT = window.innerHeight;

                this.camera.aspect = this.SCREEN_WIDTH / this.SCREEN_HEIGHT;
                this.camera.updateProjectionMatrix();

                this.renderer.setSize(this.SCREEN_WIDTH, this.SCREEN_HEIGHT);
            };

            Workspace.prototype.render_debug_helpers = function(){
                this.scene.add(new THREE.AxisHelper(10000));
                this.scene.add(new THREE.GridHelper(10000, 100));

                _.each(this.lights.directional, function(light){
                    this.scene.add(new THREE.DirectionalLightHelper(light, 100));
                }, this);
            };

            Workspace.prototype.spin_camera = function(){
                this._spin_camera_theta = this._spin_camera_theta || 0;

                this.camera.position.x = -1000 * Math.sin(this._spin_camera_theta * Math.PI / 360);
                this.camera.position.z = -1000 * Math.cos(this._spin_camera_theta * Math.PI / 360);
                this.camera.lookAt(this.scene.position);
                this._spin_camera_theta += 0.25;
            };

            Workspace.prototype.render = function(){
                requestAnimationFrame(function(){ this.render() }.bind(this));

                // this.spin_camera();

                // ball.rotation.y += 0.005;
                // plane.rotation.y += 0.0005;

                this.renderer.render(this.scene, this.camera);
                if (this.controls) this.controls.update();
            };

            // ==================================================

            var workspace = new Workspace();

            $(window).resize(function(){
                workspace.update_camera();
            });

            var material = new THREE.MeshLambertMaterial({
                // side: THREE.FrontSide,
                shading: THREE.FlatShading,
                color: 0xff0000,
                // wireframe: true,
            });

            var ka = 0.4;
            material.ambient.setRGB( material.color.r * ka, material.color.g * ka, material.color.b * ka );

            var terrain = new THREE.Geometry();

            terrain.vertices.push(new THREE.Vector3(0, 0, 0));
            terrain.vertices.push(new THREE.Vector3(0, 0, 100));
            terrain.vertices.push(new THREE.Vector3(100, 25, 100));
            terrain.vertices.push(new THREE.Vector3(100, 0, 0));

            terrain.vertices.push(new THREE.Vector3(0, 0, 100));
            terrain.vertices.push(new THREE.Vector3(0, 0, 200));
            terrain.vertices.push(new THREE.Vector3(200, 0, 0));

            var face;

            face = new THREE.Face3(0,1,2);
            face.normal = new THREE.Vector3(0,0,-1);
            terrain.faces.push(face);

            face = new THREE.Face3(0,2,3);
            terrain.faces.push(face);

            face = new THREE.Face3(4,5,2);
            // face.normal = new THREE.Vector3(0,0,-1);
            terrain.faces.push(face);

            terrain.computeBoundingSphere();

            workspace.scene.add(new THREE.Mesh(terrain, material));
        </script>
    </body>
</html>